(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{a9c1:function(t,e,n){"use strict";n.r(e);n("zKZe"),n("TeQF");var a=n("FAbG"),o=(n("2B1R"),n("+2oP"),n("SYor"),n("zAiI")),i=n("U4yp"),r={components:{XlsxRead:o.a,XlsxJson:i.a},name:"AntImportXlsx",props:{columns:Array,accept:{type:String,default:".xlsx"}},data:function(){return{file:null}},methods:{onChange:function(t){this.file=t.target.files?t.target.files[0]:null,this.$emit("change")},parsed:function(t){var e=this,n=this.columns;if(t&&t.length>0){var a=t.reduce((function(t,e,a){return t.push(n.reduce((function(t,n,o){return t[n.dataIndex]=n.format?n.format(e[o]):e[o],t.__row_key=a,t}),{})),t}),[]);this.$nextTick((function(){e.$emit("parsed",a),e.file=null}))}}}},s=n("KHd+"),l=Object(s.a)(r,(function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("input",{attrs:{type:"file",accept:this.accept},on:{change:this.onChange}}),this._v(" "),e("xlsx-read",{attrs:{file:this.file}},[e("xlsx-json",{attrs:{options:{header:1}},on:{parsed:this.parsed}})],1)],1)}),[],!1,null,null,null).exports,c=(n("yq1k"),n("JTJg"),n("rB9j"),n("UxlC"),n("ma9I"),n("07d7"),n("5s+n"),n("sMBO"),n("pjDv"),n("PKPk"),n("pNMO"),n("4Brf"),n("0oug"),n("4mDm"),n("3bBZ"),n("o0o1")),u=n.n(c);function d(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return p(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return p(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var a=0,o=function(){};return{s:o,n:function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,r=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return r=t.done,t},e:function(t){s=!0,i=t},f:function(){try{r||null==n.return||n.return()}finally{if(s)throw i}}}}function p(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++)a[n]=t[n];return a}function m(t,e,n,a,o,i,r){try{var s=t[i](r),l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,o)}var f={globName:"AModal",mixins:[n("TnLG").Modal],props:{draggable:{type:Boolean,default:!0},centered:{type:Boolean,default:!0},cancelText:{type:String,default:"关闭"},okText:{type:String,default:"保存"}},watch:{visible:{handler:function(t){var e,n=this;return(e=u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.$nextTick(),setTimeout((function(){n.handleModalDrag(t)}),30);case 2:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(a,o){var i=e.apply(t,n);function r(t){m(i,a,o,r,s,"next",t)}function s(t){m(i,a,o,r,s,"throw",t)}r(void 0)}))})()}}},methods:{handleModalDrag:function(t){if(t){var e,n=d(document.querySelectorAll(".ant-modal-wrap"));try{for(n.s();!(e=n.n()).done;){var a=e.value,o=this.getStyle(a,"display"),i=a.getAttribute("data-drag");"none"!==o&&null===i&&this.drag(a)}}catch(t){n.e(t)}finally{n.f()}}},getStyle:function(t,e){return window.document.currentStyle?t.currentStyle[e]:getComputedStyle(t,!1)[e]},drag:function(t){var e=this;if(t){t.setAttribute("data-drag",this.draggable);var n=t.querySelector(".ant-modal-header"),a=t.querySelector(".ant-modal");n&&a&&this.draggable&&(n.style.cursor="move",n.onmousedown=function(t){var n=t.clientX,o=t.clientY,i=document.body.clientWidth,r=document.documentElement.clientHeight,s=a.offsetWidth,l=a.offsetHeight,c=a.offsetLeft,u=i-a.offsetLeft-s,d=a.offsetTop,p=r-a.offsetTop-l,m=e.getStyle(a,"left"),f=e.getStyle(a,"top"),h=m,g=f;m.includes("%")?(h=+document.body.clientWidth*(+m.replace(/%/g,"")/100),g=+document.body.clientHeight*(+f.replace(/%/g,"")/100)):(h=+m.replace(/px/g,""),g=+f.replace(/px/g,"")),document.onmousemove=function(t){var e=t.clientX-n,i=t.clientY-o;-e>c?e=-c:e>u&&(e=u),-i>d?i=-d:i>p&&(i=p),a.style.cssText+=";left:".concat(e+h,"px;top:").concat(i+g,"px;")},document.onmouseup=function(t){document.onmousemove=null,document.onmouseup=null}})}}}},h={name:"AntImport",components:{AImportXlsx:l,ADraggableModal:Object(s.a)(f,void 0,void 0,!1,null,null,null).exports},props:{open:{type:Boolean,default:!1},columns:{type:Array,default:function(){return[{title:"编码",dataIndex:"code",sorter:!0,desc:"两个字符5位数字"},{title:"名称",dataIndex:"name",format:function(t){return"「"+t+"」"},desc:"最少两个中文汉字"}]}},title:{type:String,default:"数据导入"},top:{type:String,default:"20px"},width:{type:String,default:"90%"},height:{type:String,default:"600px"},action:{type:String,default:""}},data:function(){return{visible:!1,loading:!1,result:"",step:0,data:[]}},computed:{sampleColumns:function(){return this.columns.map((function(t){return Object.assign({},{label:t.title,field:t.dataIndex,dataFormat:t.format})}))},sampleData:function(){return[this.columns.reduce((function(t,e){return t[e.dataIndex]=e.desc,t}),{})]}},watch:{open:function(t){this.visible=t,this.step=1,this.result=""}},methods:{onChangeSteps:function(t){this.step=t},importFromFile:function(t){var e=this;this.data=(t.length>1?t.slice(1):t).filter((function(t){return!e.$isEmpty(e.columns.reduce((function(e,n){return e+(""+(t.hasOwnProperty(n.dataIndex)&&void 0!==t[n.dataIndex]&&null!==t[n.dataIndex]?t[n.dataIndex]:"")).trim()}),""))})),this.step=2},onClickBegin:function(){if(!this.$isEmpty(this.action)){var t=new FormData,e=this;t.append("file",new Blob([JSON.stringify(this.data.map((function(t){var e=Object.assign({},t);return delete e.__row_key,e})),null,2)],{type:"application/json;charset=UTF-8"})),e.loading=!0,this.$postfile(this.action,t).then((function(t){200===t.code?(e.result=t.msg,e.$message.success(t.msg)):(e.result=t.msg,e.$message.error(t.msg)),e.loading=!1,e.$emit("ok",t),setTimeout((function(){e.close()}),2e3)}),(function(t){e.loading=!1}))}},close:function(){this.$emit("close"),this.visible=!1}},created:function(){},mounted:function(){}},g=Object(s.a)(h,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("a-draggable-modal",{attrs:{draggable:!0,title:t.title,"body-style":{overflow:"scroll",height:t.height},"dialog-style":{top:t.top},visible:t.visible,maskClosable:!1,cancelText:"关闭",footer:null,width:t.width},on:{cancel:t.close}},[n("a-layout-content",[n("a-layout",{staticStyle:{background:"#fff"}},[n("a-layout-sider",{staticStyle:{background:"#fff","border-right":"1px solid #cfcfcf"},attrs:{width:"30%"}},[n("a-steps",{attrs:{direction:"vertical"},on:{change:t.onChangeSteps},model:{value:t.step,callback:function(e){t.step=e},expression:"step"}},[n("a-step",{attrs:{title:"下载模版",description:"请使用模版文件"}}),t._v(" "),n("a-step",{attrs:{title:"选择文件",description:"请选择上传的Excel文件"}}),t._v(" "),n("a-step",{attrs:{title:"核对数据",description:"上传前对数据进行确认"}}),t._v(" "),n("a-step",{attrs:{title:"完成",description:"上传结果显示"}})],1)],1),t._v(" "),n("a-layout-content",{style:{padding:"0 24px",minHeight:"280px"}},[0===t.step?n("div",[n("vue-excel-xlsx",{attrs:{data:t.sampleData,columns:t.sampleColumns,filename:t.title}},[t._v("\n                        点我下载模版\n                    ")]),t._v(" "),n("p",[t._v("注：模版中第一行为表头，第二行为列的样例说明，数据行导入是从第二行开始")])],1):t._e(),t._v(" "),1===t.step?n("a-import-xlsx",{attrs:{columns:t.columns},on:{parsed:t.importFromFile}}):t._e(),t._v(" "),2===t.step?n("a-table",{attrs:{bordered:"",size:"small",columns:t.columns,pagination:{pageSize:10},"data-source":t.data,scroll:{y:420},rowKey:"__row_key"},scopedSlots:t._u([{key:"footer",fn:function(e){return[t._v("\n                        总计："+t._s(t.data.length)+"行\n                    ")]}}],null,!1,2762726685)}):t._e(),t._v(" "),n("div",[3===t.step?n("a-button",{attrs:{type:"primary",disabled:t.loading,loading:t.loading},on:{click:t.onClickBegin}},[t._v("\n                        开始\n                    ")]):t._e(),t._v(" "),n("p",{directives:[{name:"show",rawName:"v-show",value:!t.$isEmpty(t.result),expression:"!$isEmpty(result)"}]},[t._v(t._s(t.result))])],1)],1)],1)],1)],1)}),[],!1,null,"2839c67a",null).exports,b={mixins:[n("K49p").a],components:{AImport:g,Search:a.a},props:{},data:function(){return{table:{actions:{list:this.$api.moduleCoreDepartments,remove:this.$api.moduleCoreDepartments},columns:[{title:"#",dataIndex:"id",fixed:"left"},{title:"上级部门",scopedSlots:{customRender:"pid"}},{title:"编码",dataIndex:"code"},{title:"名称",scopedSlots:{customRender:"name"}},{title:"简称",dataIndex:"short"},{title:"别名",dataIndex:"alias"},{title:"描述",dataIndex:"description"},{title:"排序",dataIndex:"order"},{title:"类型",scopedSlots:{customRender:"type"}},{title:"类别",dataIndex:"category"},{title:"状态",scopedSlots:{customRender:"status"}},{title:"创建时间",dataIndex:"created_at"},{title:"更新时间",dataIndex:"updated_at"},{title:"操作",fixed:"right",scopedSlots:{customRender:"action"}}],params:{pid:void 0}},search:{fields:[{label:"名称",name:"name",type:"text"},{label:"简称",name:"short",type:"text"},{label:"别名",name:"alias",type:"text"},{label:"显示名称",name:"display",type:"text"},{label:"描述",name:"description",type:"text"}]},dictionary:{status:{enabled:"启用",disabled:"禁用"}},loading_status:{},breadcrumb:[],isOpenImportDialog:!1}},watch:{},computed:{},methods:{reset:function(){this.table.params.pid=void 0,this.table.params.page=1,this.table.params.per_page=30},onStatusChange:function(t){var e=this,n=[1,0][t.status];this.loading_status["_"+t.id]=!0,this.$put(this.$api.moduleCoreDepartments+"/"+t.id,Object.assign({},t,{status:n})).then((function(a){if(e.loading_status["_"+t.id]=!1,200!==a.code)return e.$message.error(a.msg);t.status=n,e.$message.success(a.msg)})).catch((function(){return e.loading_status["_"+t.id]=!1}))},onClickName:function(t){t.path?(t.path.length>0?this.breadcrumb=t.path.reduce((function(e,n){return e.push({id:t.path[e.length],name:t.path_text[e.length],order:e.length}),e}),[]):0===this.breadcrumb.filter((function(e){return e.id===t.id})).length&&this.breadcrumb.push(t),this.reset()):this.breadcrumb=this.breadcrumb.filter((function(e){return e.order<=t.order})),this.table.params.pid=t.id,this.loadTableData()},openImportDialog:function(){this.isOpenImportDialog=!0},handleImport:function(t){t&&console.log(t)},onload:function(){this.reset(),this.loadTableData()}},created:function(){this.onload()},mounted:function(){}},y=Object(s.a)(b,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticClass:"admin_table_page_title"},[n("a-breadcrumb",[n("a-breadcrumb-item",[t.breadcrumb.length>0?n("a-button",{attrs:{type:"link"},on:{click:function(e){return t.onload()}}},[n("a-icon",{attrs:{type:"home"}}),t._v("部门列表")],1):n("span",[t._v("部门列表")])],1),t._v(" "),t._l(t.breadcrumb,(function(e){return n("a-breadcrumb-item",{key:e.id},[n("a-button",{attrs:{type:"link"},on:{click:function(n){return t.onClickName(e)}}},[t._v("\n                    "+t._s(e.name)+"\n                ")])],1)}))],2)],1),t._v(" "),n("div",{staticClass:"unline underm"}),t._v(" "),n("div",{staticClass:"admin_table_list"},[n("a-table",{attrs:{size:"small",columns:t.table.columns,"data-source":t.table.data,scroll:{y:t.sysWindowHeight-400},loading:t.table.loading,pagination:!1,"row-selection":{selectedRowKeys:t.table.selectedRowKeys,onChange:t.handleTableRowKeysChange},"row-key":"id"},scopedSlots:t._u([{key:"title",fn:function(e){return[n("search",{attrs:{"search-config":t.search.fields,"auto-params":t.search.params,"export-config":t.exporting},on:{searchParams:t.handleTableSearchParams,handleExport:t.handleTableExport}}),t._v(" "),n("div",{staticClass:"admin_table_handle_btn"},[n("a-button",{attrs:{type:"primary",icon:"plus"},on:{click:function(e){return t.$router.push("/Admin/goodcatch/m/core/departments/form")}}},[t._v("添加")]),t._v(" "),n("a-button",{attrs:{icon:"import"},on:{click:t.openImportDialog}},[t._v("批量导入")]),t._v(" "),n("a-button",{staticClass:"admin_delete_btn",attrs:{type:"danger",icon:"delete"},on:{click:t.handleRemoveTableRows}},[t._v("批量删除")]),t._v(" "),n("a-import",{attrs:{open:t.isOpenImportDialog,top:"20%",width:"60%",height:"560px"},on:{close:function(e){t.isOpenImportDialog=!1},ok:t.handleImport}})],1)]}},{key:"pid",fn:function(e){return n("span",{},[t._v("\n                "+t._s(e.parent?e.parent.name:"--")+"\n            ")])}},{key:"name",fn:function(e){return n("a-button",{attrs:{type:"link"},on:{click:function(n){return t.onClickName(e)}}},[t._v("\n                "+t._s(e.name)+"\n            ")])}},{key:"type",fn:function(e){return n("span",{},[t._v("\n                "+t._s(0===e.type?"默认":"其他")+"\n            ")])}},{key:"status",fn:function(e){return n("a-switch",{attrs:{loading:t.loading_status["_"+e.id],"checked-children":t.dictionary.status.enabled,"un-checked-children":t.dictionary.status.disabled,"default-checked":1===e.status},on:{change:function(n){return t.onStatusChange(e)}}})}},{key:"action",fn:function(e){return n("span",{},[n("a-button",{attrs:{icon:"edit"},on:{click:function(n){return t.$router.push("/Admin/goodcatch/m/core/departments/form/"+e.id)}}},[t._v("编辑")])],1)}}])}),t._v(" "),t.table.total>0?n("div",{staticClass:"admin_pagination"},[n("a-pagination",{attrs:{"page-size":t.table.params.per_page,total:t.table.total,"show-less-items":""},on:{"update:pageSize":function(e){return t.$set(t.table.params,"per_page",e)},"update:page-size":function(e){return t.$set(t.table.params,"per_page",e)},change:t.handleTablePageChange},model:{value:t.table.params.page,callback:function(e){t.$set(t.table.params,"page",e)},expression:"table.params.page"}})],1):t._e()],1)])}),[],!1,null,"2b60e1fa",null);e.default=y.exports}}]);