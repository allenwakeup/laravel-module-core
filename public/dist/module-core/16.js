(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{FAbG:function(e,t,a){"use strict";a("zKZe"),a("FZtP"),a("tkto"),a("fbCW"),a("sMBO"),a("+2oP"),a("pNMO"),a("4Brf"),a("07d7"),a("0oug"),a("4mDm"),a("PKPk"),a("3bBZ"),a("pjDv");var n=a("wy2R"),s=a.n(n);function r(e){return function(e){if(Array.isArray(e))return o(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return o(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return o(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var i={props:{show:{type:Boolean,default:!0},searchConfig:{type:Array,default:[]},autoParams:{type:Object,default:function(){return{}}}},data:function(){return{advanced:!1,searchConfig1:[],searchConfig2:[],params:{},cascader:{},select_remote:{},load_cascader:{}}},watch:{},computed:{},methods:{search:function(){var e=this,t=Object.assign({},this.params);Object.keys(t).forEach((function(a){if(t.hasOwnProperty(a)){var n=e.searchConfig.find((function(e){return e.name===a}));if(n)switch(n.type){case"date_picker":2===t[a].length&&(t[a]=e.dateFormat(t[a][0])+" ~ "+e.dateFormat(t[a][1]))}}})),this.$emit("searchParams",t)},dateFormat:function(e){return s()(e).format("YYYY-MM-DD")},timeFormat:function(e){return s()(e).format("YYYY-MM-DD HH:mm:ss")},cascaderChange:function(e,t,a){this.params[e.name]=t[t.length-1],0===t.length&&(this.params[e.name]=void 0)},initSelect:function(e){var t=this,a=this;e.length>0&&e.forEach((function(e){"cascader"===e.type?(a.cascader[e.name]=[],t.$get(e.data,{data_type:"cascader"}).then((function(t){if(200===t.code){var n={};n[e.name]=t.data,a.cascader=Object.assign({},a.cascader,n)}})),a.$set(a.load_cascader,e.name,(function(t){var n=t[t.length-1];n.loading=!0;var s={pid:n.id,data_type:"cascader"};a.$get(e.data,s).then((function(t){n.loading=!1,n.children=t.data,a.$set(a.cascader,e.name,r(a.cascader[e.name]))}))}))):"select-remote"===e.type&&(a.select_remote[e.name]=[],a.$get(e.data,{data_type:"select"}).then((function(t){a.$set(a.select_remote,e.name,t.data);var n={};n[e.name]=t.data,a.select_remote=Object.assign({},a.select_remote,n)})))}))}},created:function(){var e=this;this.searchConfig.length<=0?this.show=!1:this.searchConfig.length<=2?this.searchConfig1=this.searchConfig:this.searchConfig.length>2&&(this.searchConfig1=this.searchConfig.slice(0,2),this.searchConfig2=this.searchConfig.slice(2));var t=Object.keys(this.autoParams);t.length>0&&t.forEach((function(t){e.params[t]=e.autoParams[t]})),this.initSelect(this.searchConfig)},mounted:function(){}},c=a("KHd+"),l=Object(c.a)(i,(function(){var e=this,t=this,a=t.$createElement,n=t._self._c||a;return t.show?n("div",{staticClass:"admin_table_page_where"},[n("a-form",{attrs:{layout:"inline"}},[n("a-row",{attrs:{gutter:12}},[t._l(t.searchConfig1,(function(e,a){return n("a-col",{key:a,attrs:{md:8,sm:24}},[n("a-form-item",{attrs:{label:e.label}},["text"===e.type?n("a-input",{attrs:{placeholder:e.placeholder||""},model:{value:t.params[e.name],callback:function(a){t.$set(t.params,e.name,a)},expression:"params[v.name]"}}):t._e(),t._v(" "),"select"===e.type?n("a-select",{attrs:{placeholder:e.placeholder||""},model:{value:t.params[e.name],callback:function(a){t.$set(t.params,e.name,a)},expression:"params[v.name]"}},t._l(e.data,(function(e,a){return n("a-select-option",{key:a,attrs:{value:e.value}},[t._v(t._s(e.label))])})),1):t._e(),t._v(" "),"select-remote"===e.type?n("a-select",{attrs:{placeholder:e.placeholder||""},model:{value:t.params[e.name],callback:function(a){t.$set(t.params,e.name,a)},expression:"params[v.name]"}},t._l(t.select_remote[e.name],(function(a,s){return t.select_remote[e.name].length>0?n("a-select-option",{key:s,attrs:{value:a.value}},[t._v(t._s(a.label))]):t._e()})),1):t._e(),t._v(" "),"cascader"===e.type?n("a-cascader",{staticStyle:{width:"100%"},attrs:{"load-data":t.load_cascader[e.name],options:t.cascader[e.name],fieldNames:{label:"name",value:"id",children:"children"},placeholder:"请选择"+e.label,"change-on-select":""},on:{change:function(a){return t.cascaderChange(e,a)}}}):t._e(),t._v(" "),"time_picker"===e.type?n("a-time-picker",{model:{value:t.params[e.name],callback:function(a){t.$set(t.params,e.name,a)},expression:"params[v.name]"}}):t._e(),t._v(" "),"date_picker"===e.type?n("a-range-picker",{staticStyle:{width:"100%"},attrs:{format:"YYYY-MM-DD","allow-clear":!1},model:{value:t.params[e.name],callback:function(a){t.$set(t.params,e.name,a)},expression:"params[v.name]"}}):t._e(),t._v(" "),"datetime_picker"===e.type?n("a-range-picker",{staticStyle:{width:"100%"},attrs:{format:"YYYY-MM-DD HH:mm:ss","show-time":"","allow-clear":!1},model:{value:t.params[e.name],callback:function(a){t.$set(t.params,e.name,a)},expression:"params[v.name]"}}):t._e()],1)],1)})),t._v(" "),t.advanced&&t.searchConfig2.length>0?t._l(t.searchConfig2,(function(e,a){return n("a-col",{key:t.searchConfig1.length+a,attrs:{md:8,sm:24}},[n("a-form-item",{attrs:{label:e.label}},["text"===e.type?n("a-input",{attrs:{placeholder:e.placeholder||""},model:{value:t.params[e.name],callback:function(a){t.$set(t.params,e.name,a)},expression:"params[v.name]"}}):t._e(),t._v(" "),"select"===e.type?n("a-select",{attrs:{placeholder:e.placeholder||""},model:{value:t.params[e.name],callback:function(a){t.$set(t.params,e.name,a)},expression:"params[v.name]"}},t._l(e.data,(function(e,a){return n("a-select-option",{key:a,attrs:{value:e.value}},[t._v(t._s(e.label))])})),1):t._e(),t._v(" "),"select-remote"===e.type?n("a-select",{attrs:{placeholder:e.placeholder||""},model:{value:t.params[e.name],callback:function(a){t.$set(t.params,e.name,a)},expression:"params[v.name]"}},t._l(t.select_remote[e.name],(function(a,s){return t.select_remote[e.name].length>0?n("a-select-option",{key:s,attrs:{value:a.value}},[t._v(t._s(a.label))]):t._e()})),1):t._e(),t._v(" "),"cascader"===e.type?n("a-cascader",{attrs:{"load-data":t.load_cascader[e.name],options:t.cascader[e.name],fieldNames:{label:"name",value:"id",children:"children"},placeholder:"请选择"+e.label,"change-on-select":""},on:{change:function(a){return t.cascaderChange(e,a)}}}):t._e(),t._v(" "),"time_picker"===e.type?n("a-time-picker",{model:{value:t.params[e.name],callback:function(a){t.$set(t.params,e.name,a)},expression:"params[v.name]"}}):t._e(),t._v(" "),"date_picker"===e.type?n("a-range-picker",{staticStyle:{width:"100%"},attrs:{format:"YYYY-MM-DD","allow-clear":!1},model:{value:t.params[e.name],callback:function(a){t.$set(t.params,e.name,a)},expression:"params[v.name]"}}):t._e(),t._v(" "),"datetime_picker"===e.type?n("a-range-picker",{staticStyle:{width:"100%"},attrs:{format:"YYYY-MM-DD HH:mm:ss","show-time":"","allow-clear":!1},model:{value:t.params[e.name],callback:function(a){t.$set(t.params,e.name,a)},expression:"params[v.name]"}}):t._e()],1)],1)})):t._e(),t._v(" "),n("a-col",{staticStyle:{"padding-top":"3px"},attrs:{md:t.advanced?12:8,sm:12}},[n("span",{staticClass:"table-page-search-submitButtons",style:t.advanced&&{float:"right",overflow:"hidden"}||{}},[n("a-button",{attrs:{icon:"search"},on:{click:function(e){return t.search()}}},[t._v("查询")]),t._v(" "),n("a-button",{staticStyle:{"margin-left":"8px"},on:{click:function(){return e.params={}}}},[t._v("重置")]),t._v(" "),t.searchConfig2.length>0?n("a",{staticStyle:{"margin-left":"8px"},on:{click:function(e){t.advanced=!t.advanced}}},[t._v("\n                    "+t._s(t.advanced?"收起":"展开")+"\n                    "),n("a-icon",{attrs:{type:t.advanced?"up":"down"}})],1):t._e()],1)])],2)],1)],1):t._e()}),[],!1,null,"5408dcec",null);t.a=l.exports},JPkc:function(e,t,a){"use strict";a.r(t);a("oVuX"),a("zKZe");var n={components:{Search:a("FAbG").a},props:{},data:function(){return{params:{page:1,per_page:30},total:0,list_loading:!1,selectedRowKeys:[],columns:[{title:"#",scopedSlots:{customRender:"id"},fixed:"left",width:80},{title:"名称",scopedSlots:{customRender:"name"},width:180},{title:"描述",dataIndex:"description",width:150},{title:"状态",scopedSlots:{customRender:"status"},width:90},{title:"指令",dataIndex:"input",width:280},{title:"执行周期",dataIndex:"cron",width:120},{title:"任务类型",scopedSlots:{customRender:"schedule_type"},width:120},{title:"分组",dataIndex:"group",width:120},{title:"排序",dataIndex:"order",width:100},{title:"单次任务",scopedSlots:{customRender:"once"},width:180},{title:"重复",scopedSlots:{customRender:"overlapping"},width:120},{title:"集群",dataIndex:"one_server",width:180},{title:"后台执行",dataIndex:"background",width:120},{title:"维护模式",dataIndex:"maintenance",width:120},{title:"创建时间",dataIndex:"created_at",width:200},{title:"更新时间",dataIndex:"updated_at",width:200},{title:"操作",fixed:"right",scopedSlots:{customRender:"action"}}],list:[],dictionary:{status:{enabled:"启用",disabled:"禁用"},schedule_type:["--","Command","Exec","Job"],once:["可循环","单次"],overlapping:["可重复","不可重复"],one_server:["多服务器","单服务器"],background:["前台执行","后台执行"],maintenance:["不执行","执行"]},loading_status:{},loading_start:{},logs:{show:!1,total:0,list:[],params:{page:1,per_page:30},columns:[{title:"状态",dataIndex:"status_text"},{title:"内容",dataIndex:"content"},{title:"时间",dataIndex:"created_at_text"}]}}},watch:{},computed:{},methods:{onSearchParams:function(e){this.getList(e)},onSelectChange:function(e){this.selectedRowKeys=e},onChange:function(e){this.params.page=e},del:function(){var e=this;if(0==this.selectedRowKeys.length)return this.$message.error("未选择数据.");this.$confirm({title:"你确定要删除选择的数据？",content:"确定删除后无法恢复.",okText:"是",okType:"danger",cancelText:"取消",onOk:function(){var t=e.selectedRowKeys.join(",");e.$delete(e.$api.moduleCoreSchedules+"/"+t).then((function(t){200==t.code?(e.onload(),e.$message.success("删除成功")):e.$message.error(t.msg)}))}})},getList:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.list_loading=!0;var a=Object.assign({},t,this.params);this.$get(this.$api.moduleCoreSchedules,a).then((function(t){200===t.code&&(e.total=t.data.total,e.list=t.data.data),e.list_loading=!1}),(function(t){e.$message.error("数据加载失败"),e.list_loading=!1}))},onload:function(){this.getList()},onStatusChange:function(e){var t=this,a=[1,0][e.status];this.loading_status["_"+e.id]=!0,this.$put(this.$api.moduleCoreSchedules+"/"+e.id,Object.assign({},e,{status:a,logs:"",payload:e.payload?JSON.stringify(e.payload):""})).then((function(n){if(t.loading_status["_"+e.id]=!1,200!==n.code)return t.$message.error(n.msg);e.status=a,t.$message.success(n.msg)})).catch((function(){return t.loading_status["_"+e.id]=!1}))},handleNameClick:function(e){var t=this;this.loading_start["_"+e.id]=!0,this.$put(this.$api.moduleCoreSchedules+"/"+e.id,Object.assign({},e,{start:1,logs:"",payload:e.payload?JSON.stringify(e.payload):""})).then((function(a){if(t.loading_start["_"+e.id]=!1,200!=a.code)return t.$message.error(a.msg);t.$message.success(a.msg)})).catch((function(){return t.loading_start["_"+e.id]=!1}))},handleIdClick:function(e){var t=this;this.logs.show=!0,this.$get(this.$api.moduleCoreSchedules+"/"+e.id+"/logs",this.logs.params).then((function(e){t.logs.total=e.data.total,t.logs.list=e.data.data}))},onChangeLogs:function(e){this.logs.params.page=e}},created:function(){this.onload()},mounted:function(){}},s=a("KHd+"),r=Object(s.a)(n,(function(){var e=this,t=this,a=t.$createElement,n=t._self._c||a;return n("div",[n("div",{staticClass:"admin_table_page_title"},[t._v("计划与任务列表")]),t._v(" "),n("div",{staticClass:"unline underm"}),t._v(" "),n("div",{staticClass:"admin_table_list"},[n("a-table",{attrs:{columns:t.columns,"data-source":t.list,loading:t.list_loading,scroll:{x:2048,y:400},pagination:!1,"row-selection":{selectedRowKeys:t.selectedRowKeys,onChange:t.onSelectChange},"row-key":"id"},scopedSlots:t._u([{key:"title",fn:function(e){return[n("search",{attrs:{"search-config":t.search},on:{searchParams:t.onSearchParams}}),t._v(" "),n("div",{staticClass:"admin_table_handle_btn"},[n("a-button",{attrs:{type:"primary",icon:"plus"},on:{click:function(e){return t.$router.push("/Admin/goodcatch/m/core/schedules/form")}}},[t._v("添加")]),t._v(" "),n("a-button",{staticClass:"admin_delete_btn",attrs:{type:"danger",icon:"delete"},on:{click:t.del}},[t._v("批量删除")])],1)]}},{key:"id",fn:function(e){return n("div",{on:{click:function(a){return t.handleIdClick(e)}}},[t._v(t._s(e.id))])}},{key:"name",fn:function(e){return n("div",{},[n("a-icon",{staticStyle:{"font-size":"24px"},attrs:{type:"play-circle",theme:"twoTone","two-tone-color":"#eb2f96",spin:t.loading_start["_"+e.id]},on:{click:function(a){return t.handleNameClick(e)}}}),t._v("\n                "+t._s(e.name)+"\n            ")],1)}},{key:"schedule_type",fn:function(e){return n("div",{},[t._v("\n                "+t._s(t.dictionary.schedule_type[e.schedule_type%t.dictionary.schedule_type.length])+"\n            ")])}},{key:"once",fn:function(e){return n("div",{},[t._v("\n                "+t._s(t.dictionary.once[e.once%t.dictionary.once.length])+"\n            ")])}},{key:"overlapping",fn:function(e){return n("div",{},[t._v("\n                "+t._s(t.dictionary.overlapping[e.overlapping%t.dictionary.overlapping.length])+"\n            ")])}},{key:"one_server",fn:function(e){return n("div",{},[t._v("\n                "+t._s(t.dictionary.one_server[e.one_server%t.dictionary.one_server.length])+"\n            ")])}},{key:"background",fn:function(e){return n("div",{},[t._v("\n                "+t._s(t.dictionary.background[e.background%t.dictionary.background.length])+"\n            ")])}},{key:"maintenance",fn:function(e){return n("div",{},[t._v("\n                "+t._s(t.dictionary.maintenance[e.maintenance%t.dictionary.maintenance.length])+"\n            ")])}},{key:"status",fn:function(e){return n("a-switch",{attrs:{loading:t.loading_status["_"+e.id],"checked-children":t.dictionary.status.enabled,"un-checked-children":t.dictionary.status.disabled,"default-checked":1===e.status},on:{change:function(a){return t.onStatusChange(e)}}})}},{key:"action",fn:function(e){return n("span",{},[n("a-button",{attrs:{icon:"edit"},on:{click:function(a){return t.$router.push("/Admin/goodcatch/m/core/schedules/form/"+e.id)}}},[t._v("编辑")])],1)}}])}),t._v(" "),t.total>0?n("div",{staticClass:"admin_pagination"},[n("a-pagination",{attrs:{"page-size":t.params.per_page,total:t.total,"show-less-items":""},on:{"update:pageSize":function(e){return t.$set(t.params,"per_page",e)},"update:page-size":function(e){return t.$set(t.params,"per_page",e)},change:t.onChange},model:{value:t.params.page,callback:function(e){t.$set(t.params,"page",e)},expression:"params.page"}})],1):t._e()],1),t._v(" "),n("a-modal",{attrs:{title:"任务详情"},model:{value:t.logs.show,callback:function(e){t.$set(t.logs,"show",e)},expression:"logs.show"}},[n("template",{slot:"footer"},[n("a-button",{key:"submit",attrs:{type:"primary"},on:{click:function(){return e.logs.show=!1}}},[t._v("\n                知道了\n            ")])],1),t._v(" "),n("a-table",{attrs:{columns:t.logs.columns,"data-source":t.logs.list,pagination:!1,"row-key":"id"}}),t._v(" "),t.logs.total>0?n("div",{staticClass:"admin_pagination"},[n("a-pagination",{attrs:{"page-size":t.logs.params.per_page,total:t.logs.total,"show-less-items":""},on:{"update:pageSize":function(e){return t.$set(t.logs.params,"per_page",e)},"update:page-size":function(e){return t.$set(t.logs.params,"per_page",e)},change:t.onChangeLogs},model:{value:t.logs.params.page,callback:function(e){t.$set(t.logs.params,"page",e)},expression:"logs.params.page"}})],1):t._e()],2)],1)}),[],!1,null,"21ec6c24",null);t.default=r.exports},fbCW:function(e,t,a){"use strict";var n=a("I+eb"),s=a("tycR").find,r=a("RNIs"),o=!0;"find"in[]&&Array(1).find((function(){o=!1})),n({target:"Array",proto:!0,forced:o},{find:function(e){return s(this,e,arguments.length>1?arguments[1]:void 0)}}),r("find")}}]);