(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{"2B1R":function(e,t,a){"use strict";var n=a("I+eb"),i=a("tycR").map;n({target:"Array",proto:!0,forced:!a("Hd5f")("map")},{map:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},JPkc:function(e,t,a){"use strict";a.r(t);a("zKZe");var n=a("tR2S"),i=a("nLtv"),s={mixins:[i.b,i.c],components:{Search:n.a},props:{},data:function(){return{table:{actions:{list:this.$api.adminSchedules,remove:this.$api.adminSchedules},columns:[{title:"#",scopedSlots:{customRender:"id"},key:"id",width:60},{title:"启动",scopedSlots:{customRender:"engine"},key:"engine",width:60},{title:"名称",scopedSlots:{customRender:"name"},key:"name",width:220},{title:"描述",dataIndex:"description",key:"description",width:240},{title:"状态",scopedSlots:{customRender:"status"},key:"status",width:90},{title:"指令",dataIndex:"input",key:"input",width:180},{title:"执行周期",dataIndex:"cron",key:"cron",width:180},{title:"任务类型",scopedSlots:{customRender:"schedule_type"},key:"schedule_type",width:120},{title:"分组",dataIndex:"group",key:"group",width:90},{title:"排序",dataIndex:"order",key:"order",width:70},{title:"单次任务",scopedSlots:{customRender:"once"},key:"once",width:80},{title:"重复",scopedSlots:{customRender:"overlapping"},key:"overlapping",width:80},{title:"集群",dataIndex:"one_server",key:"one_server",width:60},{title:"后台执行",dataIndex:"background",key:"background",width:80},{title:"维护模式",dataIndex:"maintenance",key:"maintenance",width:80},{title:"创建时间",dataIndex:"created_at",key:"created_at",width:180},{title:"更新时间",dataIndex:"updated_at",key:"updated_at",width:180},{title:"操作",fixed:"right",scopedSlots:{customRender:"action"}}]},search:{fields:[{label:"名称",name:"name",type:"text"},{label:"描述",name:"description",type:"text"},{label:"分组",name:"group",type:"text"}],quickSearch:!0},dictionary:{status:{enabled:"启用",disabled:"禁用"},schedule_type:["--","Command","Exec","Job"],once:["可循环","单次"],overlapping:["可重复","不可重复"],one_server:["多服务器","单服务器"],background:["前台执行","后台执行"],maintenance:["不执行","执行"]},loading_status:{},loading_start:{},logs:{show:!1,total:0,list:[],params:{page:1,per_page:30},columns:[{title:"状态",dataIndex:"status_text"},{title:"内容",dataIndex:"content"},{title:"时间",dataIndex:"created_at_text"}]}}},watch:{},computed:{},methods:{onStatusChange:function(e){var t=this,a=[1,0][e.status];this.loading_status["_"+e.id]=!0,this.$put(this.$api.adminSchedules+"/"+e.id,Object.assign({},e,{status:a,logs:"",payload:e.payload?JSON.stringify(e.payload):""})).then((function(n){if(t.loading_status["_"+e.id]=!1,200!==n.code)return t.$message.error(n.msg);e.status=a,t.$message.success(n.msg)})).catch((function(){return t.loading_status["_"+e.id]=!1}))},handleNameClick:function(e){var t=this;this.loading_start["_"+e.id]=!0,this.$put(this.$api.adminSchedules+"/"+e.id,Object.assign({},e,{start:1,logs:"",payload:e.payload?JSON.stringify(e.payload):""})).then((function(a){if(t.loading_start["_"+e.id]=!1,200!==a.code)return t.$message.error(a.msg);t.$message.success(a.msg)})).catch((function(){return t.loading_start["_"+e.id]=!1}))},handleIdClick:function(e){var t=this;this.logs.show=!0,this.$get(this.$api.adminSchedules+"/"+e.id+"/logs",this.logs.params).then((function(e){t.logs.total=e.data.total,t.logs.list=e.data.data}))},onChangeLogs:function(e){this.logs.params.page=e},onload:function(){this.loadTableData()}},created:function(){this.onload()},mounted:function(){}},o=a("KHd+"),c=Object(o.a)(s,(function(){var e=this,t=this,a=t.$createElement,n=t._self._c||a;return n("div",[n("div",{staticClass:"admin_table_page_title"},[t._v("计划与任务列表")]),t._v(" "),n("div",{staticClass:"unline underm"}),t._v(" "),n("div",{staticClass:"admin_table_list"},[n("a-table",{attrs:{size:t.sysSize,components:t.resizeableTitleComponents,columns:t.getCachedTableColumns(t.table.columns),"data-source":t.table.data,scroll:{x:2400,y:t.sysWindowHeight-280},loading:t.table.loading,pagination:!1,"row-selection":{columnWidth:25,selectedRowKeys:t.table.selectedRowKeys,onChange:t.handleTableRowKeysChange},"row-key":t.table.rowId},scopedSlots:t._u([{key:"title",fn:function(e){return[n("search",{attrs:{"search-config":t.search.fields,"auto-params":t.search.params},on:{searchParams:t.handleTableSearchParams}}),t._v(" "),n("div",{staticClass:"admin_table_handle_btn"},[n("a-button",{attrs:{type:"primary",size:t.sysSize,icon:"plus"},on:{click:function(e){t.$router.push(t.$moduleUrl("schedules/form"))}}},[t._v("添加")]),t._v(" "),t.search.quickSearch&&t.search.quick.data&&t.search.quick.data.length>0?n("a-radio-group",{attrs:{value:t.search.quick.selected,size:t.sysSize},on:{change:function(e){return t.handleChangeTableQuickSearch(e.target.value)}}},t._l(t.search.quick.data.slice(0,3),(function(e,a){return n("a-radio-button",{key:a,attrs:{value:a}},[t._v(t._s(e.label?e.label:"其他"))])})),1):t._e(),t._v(" "),t.search.quickSearch&&t.search.quick.data&&t.search.quick.data.length>3?n("a-select",{staticStyle:{width:"150px"},attrs:{value:t.search.quick.selected,placeholder:"更多选项",size:t.sysSize},on:{change:t.handleChangeTableQuickSearch}},t._l(t.search.quick.data,(function(e,a){return n("a-select-option",{key:a,attrs:{value:a}},[t._v(t._s(e.label?e.label:"其他"))])})),1):t._e(),t._v(" "),n("a-button",{staticClass:"admin_delete_btn",attrs:{type:"danger",size:t.sysSize,icon:"delete"},on:{click:t.handleRemoveTableRows}},[t._v("批量删除")])],1)]}},{key:"id",fn:function(e){return n("div",{on:{click:function(a){return t.handleIdClick(e)}}},[t._v(t._s(e.id))])}},{key:"engine",fn:function(e){return n("div",{},[n("a-icon",{staticStyle:{"font-size":"24px"},attrs:{type:"play-circle",theme:"twoTone","two-tone-color":"#eb2f96",spin:t.loading_start["_"+e.id]},on:{click:function(a){return t.handleNameClick(e)}}})],1)}},{key:"name",fn:function(e){return n("div",{on:{click:function(a){return t.handleIdClick(e)}}},[t._v("\n\t                "+t._s(e.name)+"\n                ")])}},{key:"schedule_type",fn:function(e){return n("div",{},[t._v("\n                    "+t._s(t.dictionary.schedule_type[e.schedule_type%t.dictionary.schedule_type.length])+"\n                ")])}},{key:"once",fn:function(e){return n("div",{},[t._v("\n                    "+t._s(t.dictionary.once[e.once%t.dictionary.once.length])+"\n                ")])}},{key:"overlapping",fn:function(e){return n("div",{},[t._v("\n                    "+t._s(t.dictionary.overlapping[e.overlapping%t.dictionary.overlapping.length])+"\n                ")])}},{key:"one_server",fn:function(e){return n("div",{},[t._v("\n                    "+t._s(t.dictionary.one_server[e.one_server%t.dictionary.one_server.length])+"\n                ")])}},{key:"background",fn:function(e){return n("div",{},[t._v("\n                    "+t._s(t.dictionary.background[e.background%t.dictionary.background.length])+"\n                ")])}},{key:"maintenance",fn:function(e){return n("div",{},[t._v("\n                    "+t._s(t.dictionary.maintenance[e.maintenance%t.dictionary.maintenance.length])+"\n                ")])}},{key:"status",fn:function(e){return n("a-switch",{attrs:{loading:t.loading_status["_"+e.id],"checked-children":t.dictionary.status.enabled,"un-checked-children":t.dictionary.status.disabled,"default-checked":1===e.status},on:{change:function(a){return t.onStatusChange(e)}}})}},{key:"action",fn:function(e){return n("span",{},[n("a-button",{attrs:{icon:"edit",size:t.sysSize},on:{click:function(a){t.$router.push(t.$moduleUrl("schedules/form/"+e.id))}}},[t._v("编辑")])],1)}}])}),t._v(" "),t.table.total>0?n("div",{staticClass:"admin_pagination"},[n("a-pagination",{attrs:{size:t.sysSize,"page-size-options":t.table.pageSizeOptions,total:t.table.total,"show-less-items":"","show-size-changer":"","show-quick-jumper":"","page-size":t.table.params.per_page},on:{change:t.handleTablePageChange,showSizeChange:t.handleTablePageSizeChange},model:{value:t.table.params.page,callback:function(e){t.$set(t.table.params,"page",e)},expression:"table.params.page"}})],1):t._e()],1),t._v(" "),n("a-modal",{attrs:{title:"任务详情"},model:{value:t.logs.show,callback:function(e){t.$set(t.logs,"show",e)},expression:"logs.show"}},[n("template",{slot:"footer"},[n("a-button",{key:"submit",attrs:{type:"primary",size:t.sysSize},on:{click:function(){return e.logs.show=!1}}},[t._v("\n                    知道了\n                ")])],1),t._v(" "),n("a-table",{attrs:{size:t.sysSize,columns:t.logs.columns,"data-source":t.logs.list,pagination:!1,"row-key":"id"}}),t._v(" "),t.logs.total>0?n("div",{staticClass:"admin_pagination"},[n("a-pagination",{attrs:{"page-size":t.logs.params.per_page,total:t.logs.total,"show-less-items":""},on:{"update:pageSize":function(e){return t.$set(t.logs.params,"per_page",e)},"update:page-size":function(e){return t.$set(t.logs.params,"per_page",e)},change:t.onChangeLogs},model:{value:t.logs.params.page,callback:function(e){t.$set(t.logs.params,"page",e)},expression:"logs.params.page"}})],1):t._e()],2)],1)}),[],!1,null,"786ea651",null);t.default=c.exports},JTJg:function(e,t,a){"use strict";var n=a("I+eb"),i=a("4zBA"),s=a("WjRb"),o=a("HYAF"),c=a("V37c"),l=a("qxPZ"),r=i("".indexOf);n({target:"String",proto:!0,forced:!l("includes")},{includes:function(e){return!!~r(c(o(this)),c(s(e)),arguments.length>1?arguments[1]:void 0)}})},yq1k:function(e,t,a){"use strict";var n=a("I+eb"),i=a("TWQb").includes,s=a("0Dky"),o=a("RNIs");n({target:"Array",proto:!0,forced:s((function(){return!Array(1).includes()}))},{includes:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),o("includes")}}]);