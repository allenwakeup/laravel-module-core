(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{a9c1:function(t,e,n){"use strict";n.r(e);n("oVuX"),n("zKZe"),n("TeQF"),n("2B1R"),n("+2oP");var a=n("zAiI"),o=n("U4yp"),i={components:{XlsxRead:a.a,XlsxJson:o.a},name:"AntImportXlsx",props:{columns:Array,accept:{type:String,default:".xlsx"}},data:function(){return{file:null}},methods:{onChange:function(t){this.file=t.target.files?t.target.files[0]:null,this.$emit("change")},parsed:function(t){var e=this,n=this.columns;if(t&&t.length>0){var a=t.reduce((function(t,e,a){return t.push(n.reduce((function(t,n,o){return t[n.dataIndex]=n.format?n.format(e[o]):e[o],t.__row_key=a,t}),{})),t}),[]);this.$nextTick((function(){e.$emit("parsed",a),e.file=null}))}}}},r=n("KHd+"),s=Object(r.a)(i,(function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("input",{attrs:{type:"file",accept:this.accept},on:{change:this.onChange}}),this._v(" "),e("xlsx-read",{attrs:{file:this.file}},[e("xlsx-json",{attrs:{options:{header:1}},on:{parsed:this.parsed}})],1)],1)}),[],!1,null,null,null).exports,l=(n("yq1k"),n("JTJg"),n("rB9j"),n("UxlC"),n("ma9I"),n("07d7"),n("5s+n"),n("sMBO"),n("pjDv"),n("PKPk"),n("pNMO"),n("4Brf"),n("0oug"),n("4mDm"),n("3bBZ"),n("o0o1")),c=n.n(l);function u(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return d(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return d(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var a=0,o=function(){};return{s:o,n:function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,r=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return r=t.done,t},e:function(t){s=!0,i=t},f:function(){try{r||null==n.return||n.return()}finally{if(s)throw i}}}}function d(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++)a[n]=t[n];return a}function p(t,e,n,a,o,i,r){try{var s=t[i](r),l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,o)}var m={globName:"AModal",mixins:[n("TnLG").Modal],props:{draggable:{type:Boolean,default:!0},centered:{type:Boolean,default:!0},cancelText:{type:String,default:"关闭"},okText:{type:String,default:"保存"}},watch:{visible:{handler:function(t){var e,n=this;return(e=c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.$nextTick(),setTimeout((function(){n.handleModalDrag(t)}),30);case 2:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(a,o){var i=e.apply(t,n);function r(t){p(i,a,o,r,s,"next",t)}function s(t){p(i,a,o,r,s,"throw",t)}r(void 0)}))})()}}},methods:{handleModalDrag:function(t){if(t){var e,n=u(document.querySelectorAll(".ant-modal-wrap"));try{for(n.s();!(e=n.n()).done;){var a=e.value,o=this.getStyle(a,"display"),i=a.getAttribute("data-drag");"none"!==o&&null===i&&this.drag(a)}}catch(t){n.e(t)}finally{n.f()}}},getStyle:function(t,e){return window.document.currentStyle?t.currentStyle[e]:getComputedStyle(t,!1)[e]},drag:function(t){var e=this;if(t){t.setAttribute("data-drag",this.draggable);var n=t.querySelector(".ant-modal-header"),a=t.querySelector(".ant-modal");n&&a&&this.draggable&&(n.style.cursor="move",n.onmousedown=function(t){var n=t.clientX,o=t.clientY,i=document.body.clientWidth,r=document.documentElement.clientHeight,s=a.offsetWidth,l=a.offsetHeight,c=a.offsetLeft,u=i-a.offsetLeft-s,d=a.offsetTop,p=r-a.offsetTop-l,m=e.getStyle(a,"left"),f=e.getStyle(a,"top"),h=m,g=f;m.includes("%")?(h=+document.body.clientWidth*(+m.replace(/%/g,"")/100),g=+document.body.clientHeight*(+f.replace(/%/g,"")/100)):(h=+m.replace(/px/g,""),g=+f.replace(/px/g,"")),document.onmousemove=function(t){var e=t.clientX-n,i=t.clientY-o;-e>c?e=-c:e>u&&(e=u),-i>d?i=-d:i>p&&(i=p),a.style.cssText+=";left:".concat(e+h,"px;top:").concat(i+g,"px;")},document.onmouseup=function(t){document.onmousemove=null,document.onmouseup=null}})}}}},f={name:"AntImport",components:{AImportXlsx:s,ADraggableModal:Object(r.a)(m,void 0,void 0,!1,null,null,null).exports},props:{open:{type:Boolean,default:!1},columns:{type:Array,default:function(){return[{title:"编码",dataIndex:"code",sorter:!0,desc:"两个字符5位数字"},{title:"名称",dataIndex:"name",format:function(t){return"「"+t+"」"},desc:"最少两个中文汉字"}]}},title:{type:String,default:"数据导入"},top:{type:String,default:"20px"},width:{type:String,default:"90%"},height:{type:String,default:"600px"}},data:function(){return{visible:!1,loading:!1,step:0,data:[]}},computed:{sampleColumns:function(){return this.columns.map((function(t){return Object.assign({},{label:t.title,field:t.dataIndex,dataFormat:t.format})}))},sampleData:function(){return[this.columns.reduce((function(t,e){return t[e.dataIndex]=e.desc,t}),{})]}},watch:{open:function(t){this.visible=t}},methods:{onChangeSteps:function(t){this.step=t},importFromFile:function(t){this.data=t.length>1?t.slice(1):t,this.step=2},handleSubmit:function(){this.$emit("ok",this.data.map((function(t){var e=Object.assign({},t);return delete e.__row_key,e}))),this.close()},close:function(){this.$emit("close"),this.visible=!1}},created:function(){},mounted:function(){}},h={components:{AImport:Object(r.a)(f,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("a-draggable-modal",{attrs:{draggable:!0,title:t.title,"body-style":{overflow:"scroll",height:t.height},"dialog-style":{top:t.top},visible:t.visible,maskClosable:!1,closable:!1,cancelText:"关闭",width:t.width},on:{cancel:t.close}},[n("a-layout-content",[n("a-layout",{staticStyle:{background:"#fff"}},[n("a-layout-sider",{staticStyle:{background:"#fff","border-right":"1px solid #cfcfcf"},attrs:{width:"30%"}},[n("a-steps",{attrs:{direction:"vertical"},on:{change:t.onChangeSteps},model:{value:t.step,callback:function(e){t.step=e},expression:"step"}},[n("a-step",{attrs:{title:"下载模版",description:"请使用模版文件"}}),t._v(" "),n("a-step",{attrs:{title:"选择文件",description:"请选择上传的Excel文件"}}),t._v(" "),n("a-step",{attrs:{title:"核对数据",description:"上传前对数据进行确认"}}),t._v(" "),n("a-step",{attrs:{title:"完成",description:"上传结果显示"}})],1)],1),t._v(" "),n("a-layout-content",{style:{padding:"0 24px",minHeight:"280px"}},[0===t.step?n("div",[n("vue-excel-xlsx",{attrs:{data:t.sampleData,columns:t.sampleColumns,filename:t.title}},[t._v("\n                        点我下载模版\n                    ")]),t._v(" "),n("p",[t._v("注：模版中第一行为表头，第二行为列的样例说明，数据行导入是从第二行开始")])],1):t._e(),t._v(" "),1===t.step?n("a-import-xlsx",{attrs:{columns:t.columns},on:{parsed:t.importFromFile}}):t._e(),t._v(" "),2===t.step?n("a-table",{attrs:{bordered:"",size:"small",columns:t.columns,pagination:{pageSize:10},"data-source":t.data,scroll:{y:420},rowKey:"__row_key"},scopedSlots:t._u([{key:"footer",fn:function(e){return[t._v("\n                        总计："+t._s(t.data.length)+"行\n                    ")]}}],null,!1,2762726685)}):t._e(),t._v(" "),n("div",[3===t.step?n("a-button",{attrs:{type:"primary",disabled:t.loading,loading:t.loading},on:{click:function(e){t.loading=!0}}},[t._v("\n                        开始\n                    ")]):t._e()],1)],1)],1)],1),t._v(" "),n("template",{slot:"footer"},[n("a-button",{key:"back",on:{click:t.handleSubmit}},[t._v("\n            关闭\n        ")])],1)],2)}),[],!1,null,"9949f548",null).exports},props:{},data:function(){return{params:{page:1,per_page:30},total:0,selectedRowKeys:[],columns:[{title:"#",dataIndex:"id",fixed:"left"},{title:"上级部门",scopedSlots:{customRender:"pid"}},{title:"编码",dataIndex:"code"},{title:"名称",scopedSlots:{customRender:"name"}},{title:"简称",dataIndex:"short"},{title:"别名",dataIndex:"alias"},{title:"描述",dataIndex:"description"},{title:"排序",dataIndex:"order"},{title:"类型",scopedSlots:{customRender:"type"}},{title:"类别",dataIndex:"category"},{title:"状态",scopedSlots:{customRender:"status"}},{title:"创建时间",dataIndex:"created_at"},{title:"更新时间",dataIndex:"updated_at"},{title:"操作",fixed:"right",scopedSlots:{customRender:"action"}}],list:[],dictionary:{status:{enabled:"启用",disabled:"禁用"}},loading_status:{},breadcrumb:[],isOpenImportDialog:!1}},watch:{},computed:{},methods:{onSelectChange:function(t){this.selectedRowKeys=t},onChange:function(t){this.params.page=t},del:function(){var t=this;if(0===this.selectedRowKeys.length)return this.$message.error("未选择数据.");this.$confirm({title:"你确定要删除选择的数据？",content:"确定删除后无法恢复.",okText:"是",okType:"danger",cancelText:"取消",onOk:function(){var e=t.selectedRowKeys.join(",");t.$delete(t.$api.moduleCoreDepartments+"/"+e).then((function(e){200===e.code?(t.onload(),t.$message.success("删除成功")):t.$message.error(e.msg)}))}})},onStatusChange:function(t){var e=this,n=[1,0][t.status];this.loading_status["_"+t.id]=!0,this.$put(this.$api.moduleCoreDepartments+"/"+t.id,Object.assign({},t,{status:n})).then((function(a){if(e.loading_status["_"+t.id]=!1,200!==a.code)return e.$message.error(a.msg);t.status=n,e.$message.success(a.msg)})).catch((function(){return e.loading_status["_"+t.id]=!1}))},onClickName:function(t){t.path?(t.path.length>0?this.breadcrumb=t.path.reduce((function(e,n){return e.push({id:t.path[e.length],name:t.path_text[e.length],order:e.length}),e}),[]):0===this.breadcrumb.filter((function(e){return e.id===t.id})).length&&this.breadcrumb.push(t),this.params={page:1,per_page:30}):this.breadcrumb=this.breadcrumb.filter((function(e){return e.order<=t.order})),this.getList(t.id)},openImportDialog:function(){this.isOpenImportDialog=!0},handleImport:function(t){t&&console.log(t)},getList:function(t){var e=this;t||(this.breadcrumb=[]);var n=t?Object.assign({},this.params,{pid:t}):this.params;this.$get(this.$api.moduleCoreDepartments,n).then((function(t){e.total=t.data.total,e.list=t.data.data}))},onload:function(){this.getList()}},created:function(){this.onload()},mounted:function(){}},g=Object(r.a)(h,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticClass:"admin_table_page_title"},[n("a-breadcrumb",[n("a-breadcrumb-item",[t.breadcrumb.length>0?n("a-button",{attrs:{type:"link"},on:{click:function(e){return t.getList()}}},[n("a-icon",{attrs:{type:"home"}}),t._v("部门列表")],1):n("span",[t._v("部门列表")])],1),t._v(" "),t._l(t.breadcrumb,(function(e){return n("a-breadcrumb-item",{key:e.id},[n("a-button",{attrs:{type:"link"},on:{click:function(n){return t.onClickName(e)}}},[t._v("\n                    "+t._s(e.name)+"\n                ")])],1)}))],2)],1),t._v(" "),n("div",{staticClass:"unline underm"}),t._v(" "),n("div",{staticClass:"admin_table_handle_btn"},[n("a-button",{attrs:{type:"primary",icon:"plus"},on:{click:function(e){return t.$router.push("/Admin/goodcatch/m/core/departments/form")}}},[t._v("添加")]),t._v(" "),n("a-button",{attrs:{icon:"import"},on:{click:t.openImportDialog}},[t._v("批量导入")]),t._v(" "),n("a-button",{staticClass:"admin_delete_btn",attrs:{type:"danger",icon:"delete"},on:{click:t.del}},[t._v("批量删除")]),t._v(" "),n("a-import",{attrs:{open:t.isOpenImportDialog,top:"20%",width:"60%",height:"560px"},on:{close:function(e){t.isOpenImportDialog=!1},ok:t.handleImport}})],1),t._v(" "),n("div",{staticClass:"admin_table_list"},[n("a-table",{attrs:{columns:t.columns,"data-source":t.list,pagination:!1,"row-selection":{selectedRowKeys:t.selectedRowKeys,onChange:t.onSelectChange},"row-key":"id"},scopedSlots:t._u([{key:"pid",fn:function(e){return n("span",{},[t._v("\n                "+t._s(e.parent?e.parent.name:"--")+"\n            ")])}},{key:"name",fn:function(e){return n("a-button",{attrs:{type:"link"},on:{click:function(n){return t.onClickName(e)}}},[t._v("\n                "+t._s(e.name)+"\n            ")])}},{key:"type",fn:function(e){return n("span",{},[t._v("\n                "+t._s(0===e.type?"默认":"其他")+"\n            ")])}},{key:"status",fn:function(e){return n("a-switch",{attrs:{loading:t.loading_status["_"+e.id],"checked-children":t.dictionary.status.enabled,"un-checked-children":t.dictionary.status.disabled,"default-checked":1===e.status},on:{change:function(n){return t.onStatusChange(e)}}})}},{key:"action",fn:function(e){return n("span",{},[n("a-button",{attrs:{icon:"edit"},on:{click:function(n){return t.$router.push("/Admin/goodcatch/m/core/departments/form/"+e.id)}}},[t._v("编辑")])],1)}}])}),t._v(" "),t.total>0?n("div",{staticClass:"admin_pagination"},[n("a-pagination",{attrs:{"page-size":t.params.per_page,total:t.total,"show-less-items":""},on:{"update:pageSize":function(e){return t.$set(t.params,"per_page",e)},"update:page-size":function(e){return t.$set(t.params,"per_page",e)},change:t.onChange},model:{value:t.params.page,callback:function(e){t.$set(t.params,"page",e)},expression:"params.page"}})],1):t._e()],1)])}),[],!1,null,"bf67cbbc",null);e.default=g.exports}}]);