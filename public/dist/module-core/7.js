(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{A7DA:function(e,a,t){var r=t("h4qf");"string"==typeof r&&(r=[[e.i,r,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};t("aET+")(r,o);r.locals&&(e.exports=r.locals)},Dox9:function(e,a,t){"use strict";t("A7DA")},dfMr:function(e,a,t){"use strict";t.r(a);var r={components:{},props:{},data:function(){return{data_routes:[],left_tables:[],right_tables:[],relationships:[{value:"morphToMany",name:"多对多（多态）"}],form:{data_route_id:"",left:"",left_table:"",left_tpl:"",right:"",right_table:"",right_tpl:"",relationship:"morphToMany",name:"left",description:"",table:"core_data_mappings",through:"",first_key:"",second_key:"",foreign_key:"",owner_key:"",local_key:"",second_local_key:"",foreign_pivot_key:"left_id",related_pivot_key:"right_id",parent_key:"",related_key:"",relation:"",status:1},id:0,rules:{data_route_id:[{required:!0,message:"请选择数据路径"}],left:[{required:!0,message:"请填写左表名称"}],left_table:[{required:!0,message:"请选择左表"}],left_tpl:[{required:!0,message:"请填写左表模板"}],right:[{required:!0,message:"请填写右表名称"}],right_table:[{required:!0,message:"请选择右表"}],right_tpl:[{required:!0,message:"请填写右表模板"}],name:[{required:!0,message:"请填写多态前缀"}],foreign_pivot_key:[{required:!0,message:"请填写Foreign Pivot Key"}],related_pivot_key:[{required:!0,message:"请填写Related Pivot Key"}],parent_key:[{required:!0,message:"请填写Parent Key"}],related_key:[{required:!0,message:"请填写Related Key"}]}}},watch:{},computed:{},methods:{handleSubmit:function(){var e=this;this.$refs.form.validate((function(a){if(!a)return e.$message.error("请正确填写表单！"),!1;var t=e.$apiHandle(e.$api.moduleCoreDataMaps,e.id);t.status?e.$put(t.url,e.form).then((function(a){return 200==a.code?(e.$message.success(a.msg),e.$router.back()):e.$message.error(a.msg)})):e.$post(t.url,e.form).then((function(a){return 200==a.code||201==a.code?(e.$message.success(a.msg),e.$router.back()):e.$message.error(a.msg)}))}))},handleDataRouteSearch:function(e){this.getDataRouteSelector({keyword:e})},handleDataRouteChange:function(e){this.form.data_route_id=e},handleLeftTableSearch:function(e){this.getLeftTableSelector({keyword:e})},handleLeftTableChange:function(e){this.form.left_table=e},handleRightTableSearch:function(e){this.getRightTableSelector({keyword:e})},handleRightTableChange:function(e){this.form.right_table=e},onChangeStatus:function(e){this.form.status=e?1:0},get_form:function(){var e=this;this.$get(this.$api.moduleCoreDataMaps+"/"+this.id).then((function(a){e.form=a.data}))},getDataRouteSelector:function(e){var a=this;this.$get(this.$api.moduleCoreDataRoutes,e).then((function(e){e.data&&e.data.data&&(a.data_routes=e.data.data)}))},getLeftTableSelector:function(e){var a=this;this.$get(this.$api.moduleCoreDatabases,e).then((function(e){e.data&&e.data.data&&(a.left_tables=e.data.data)}))},getRightTableSelector:function(e){var a=this;this.$get(this.$api.moduleCoreDatabases,e).then((function(e){e.data&&e.data.data&&(a.right_tables=e.data.data)}))},onload:function(){this.$isEmpty(this.$route.params.id)||(this.id=this.$route.params.id,this.get_form()),this.getDataRouteSelector(),this.getLeftTableSelector(),this.getRightTableSelector()}},created:function(){this.onload()},mounted:function(){}},o=(t("Dox9"),t("KHd+")),l=Object(o.a)(r,(function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",[t("div",{staticClass:"admin_table_page_title"},[t("a-button",{staticClass:"float_right",attrs:{icon:"arrow-left"},on:{click:function(a){return e.$router.back()}}},[e._v("返回")]),e._v("\n            数据映射编辑\n        ")],1),e._v(" "),t("div",{staticClass:"unline underm"}),e._v(" "),t("div",{staticClass:"admin_form"},[t("a-form-model",{ref:"form",attrs:{model:e.form,rules:e.rules}},[t("a-row",[t("a-col",[t("a-form-model-item",{attrs:{label:"数据路径",labelCol:{span:2},wrapperCol:{span:8},prop:"data_route_id"}},[t("a-select",{attrs:{"show-search":"",placeholder:"选择数据路径",value:e.form.data_route_id,model:e.form.data_route_id,"filter-option":!1,"not-found-content":"没有更多的数据路径"},on:{search:e.handleDataRouteSearch,change:e.handleDataRouteChange}},e._l(e.data_routes,(function(a){return t("a-select-option",{key:a.id,attrs:{value:a.id}},[e._v("\n                                    "+e._s(a.name)+"\n                                ")])})),1)],1)],1)],1),e._v(" "),t("a-row",[t("a-col",{attrs:{span:12}},[t("a-form-model-item",{attrs:{label:"左表名称",labelCol:{span:4},wrapperCol:{span:16},prop:"left"}},[t("a-input",{attrs:{placeholder:"请输入左表名称"},model:{value:e.form.left,callback:function(a){e.$set(e.form,"left",a)},expression:"form.left"}})],1)],1),e._v(" "),t("a-col",{attrs:{span:12}},[t("a-form-model-item",{attrs:{label:"左表",labelCol:{span:4},wrapperCol:{span:16},prop:"left_table"}},[t("a-select",{attrs:{"show-search":"",placeholder:"选择左表",value:e.form.left_table,model:e.form.left_table,"filter-option":!1,"not-found-content":"没有更多的数据库表"},on:{search:e.handleLeftTableSearch,change:e.handleLeftTableChange}},e._l(e.left_tables,(function(a){return t("a-select-option",{key:a.id,attrs:{value:a.id}},[e._v("\n                                    "+e._s(a.name)+"\n                                ")])})),1)],1)],1)],1),e._v(" "),t("a-row",[t("a-col",[t("a-form-model-item",{attrs:{label:"左表模板",labelCol:{span:2},wrapperCol:{span:16},prop:"left_tpl"}},[t("a-textarea",{attrs:{placeholder:"用来显示的列，支持字段名+转换规则，\n如：表列名有name、department，想要显示成「department」name前两个字符的拼接格式，\n可以设置成 department::prepend:「|append:」+name::substr:0,2\n","auto-size":{minRows:5,maxRows:8}},model:{value:e.form.left_tpl,callback:function(a){e.$set(e.form,"left_tpl",a)},expression:"form.left_tpl"}})],1)],1)],1),e._v(" "),t("a-row",[t("a-col",[t("a-form-model-item",{attrs:{label:"关联关系",labelCol:{span:2},wrapperCol:{span:8}}},[t("a-select",{attrs:{"default-value":"morphToMany",disabled:""}},e._l(e.relationships,(function(a){return t("a-select-option",{key:a.value,attrs:{value:a.value}},[e._v("\n                                    "+e._s(a.name)+"\n                                ")])})),1)],1)],1)],1),e._v(" "),t("a-row",[t("a-col",{attrs:{span:12}},[t("a-form-model-item",{attrs:{label:"右表名称",labelCol:{span:4},wrapperCol:{span:16},prop:"right"}},[t("a-input",{attrs:{placeholder:"请输入右表名称"},model:{value:e.form.right,callback:function(a){e.$set(e.form,"right",a)},expression:"form.right"}})],1)],1),e._v(" "),t("a-col",{attrs:{span:12}},[t("a-form-model-item",{attrs:{label:"右表",labelCol:{span:4},wrapperCol:{span:16},prop:"right_table"}},[t("a-select",{attrs:{"show-search":"",placeholder:"选择右表",value:e.form.right_table,model:e.form.right_table,"filter-option":!1,"not-found-content":"没有更多的数据库表"},on:{search:e.handleRightTableSearch,change:e.handleRightTableChange}},e._l(e.right_tables,(function(a){return t("a-select-option",{key:a.id,attrs:{value:a.id}},[e._v("\n                                    "+e._s(a.name)+"\n                                ")])})),1)],1)],1)],1),e._v(" "),t("a-row",[t("a-col",[t("a-form-model-item",{attrs:{label:"右表模板",labelCol:{span:2},wrapperCol:{span:16},prop:"right_tpl"}},[t("a-textarea",{attrs:{placeholder:"用来显示的列，支持字段名+转换规则，\n如：表列名有name、department，想要显示成「department」name前两个字符的拼接格式，\n可以设置成 department::prepend:「|append:」+name::substr:0,2\n","auto-size":{minRows:5,maxRows:8}},model:{value:e.form.right_tpl,callback:function(a){e.$set(e.form,"right_tpl",a)},expression:"form.right_tpl"}})],1)],1)],1),e._v(" "),t("a-row",[t("a-col",{attrs:{span:12}},[t("a-form-model-item",{attrs:{label:"多态前缀",labelCol:{span:4},wrapperCol:{span:16},prop:"name"}},[t("a-input",{attrs:{placeholder:"请输入多态前缀"},model:{value:e.form.name,callback:function(a){e.$set(e.form,"name",a)},expression:"form.name"}},[t("a-tooltip",{attrs:{slot:"suffix",title:"在多态关系中，列名通常为 「前缀名」 + 「_type」， 「前缀名」 + 「_id」"},slot:"suffix"},[t("a-icon",{attrs:{type:"info-circle"}})],1)],1)],1)],1),e._v(" "),t("a-col",{attrs:{span:12}},[t("a-form-model-item",{attrs:{label:"表名",labelCol:{span:4},wrapperCol:{span:16},prop:"table"}},[t("a-input",{attrs:{disabled:""},model:{value:e.form.table,callback:function(a){e.$set(e.form,"table",a)},expression:"form.table"}})],1)],1)],1),e._v(" "),t("a-row",[t("a-col",{attrs:{span:12}},[t("a-form-model-item",{attrs:{label:"Foreign Pivot Key",labelCol:{span:4},wrapperCol:{span:16},prop:"foreign_pivot_key"}},[t("a-input",{model:{value:e.form.foreign_pivot_key,callback:function(a){e.$set(e.form,"foreign_pivot_key",a)},expression:"form.foreign_pivot_key"}})],1)],1),e._v(" "),t("a-col",{attrs:{span:12}},[t("a-form-model-item",{attrs:{label:"Related Pivot Key",labelCol:{span:4},wrapperCol:{span:16},prop:"related_pivot_key"}},[t("a-input",{model:{value:e.form.related_pivot_key,callback:function(a){e.$set(e.form,"related_pivot_key",a)},expression:"form.related_pivot_key"}})],1)],1)],1),e._v(" "),t("a-row",[t("a-col",{attrs:{span:12}},[t("a-form-model-item",{attrs:{label:"Parent Key",labelCol:{span:4},wrapperCol:{span:16},prop:"parent_key"}},[t("a-input",{attrs:{placeholder:"关联主表的主键名，如：id"},model:{value:e.form.parent_key,callback:function(a){e.$set(e.form,"parent_key",a)},expression:"form.parent_key"}})],1)],1),e._v(" "),t("a-col",{attrs:{span:12}},[t("a-form-model-item",{attrs:{label:"Related Key",labelCol:{span:4},wrapperCol:{span:16},prop:"related_key"}},[t("a-input",{attrs:{placeholder:"关联副表的主键名，如：id"},model:{value:e.form.related_key,callback:function(a){e.$set(e.form,"related_key",a)},expression:"form.related_key"}})],1)],1)],1),e._v(" "),t("a-row",[t("a-col",[t("a-form-model-item",{attrs:{label:"描述",labelCol:{span:2},wrapperCol:{span:16},prop:"description"}},[t("a-textarea",{attrs:{placeholder:"这个数据映射是用来干啥的？什么都没写","auto-size":{minRows:3,maxRows:5}},model:{value:e.form.description,callback:function(a){e.$set(e.form,"description",a)},expression:"form.description"}})],1)],1)],1),e._v(" "),t("a-row",[t("a-col",{attrs:{span:12}},[t("a-form-model-item",{attrs:{label:"状态",labelCol:{span:4},wrapperCol:{span:16}}},[t("a-switch",{attrs:{"checked-children":"启用","un-checked-children":"禁用",checked:1===e.form.status},on:{change:e.onChangeStatus}})],1)],1)],1),e._v(" "),t("a-row",[t("a-col",[t("a-form-model-item",{attrs:{labelCol:{span:4},"wrapper-col":{span:12,offset:5}}},[t("a-button",{attrs:{type:"primary"},on:{click:e.handleSubmit}},[e._v("提交")])],1)],1)],1)],1)],1)])}),[],!1,null,"35a1e513",null);a.default=l.exports},h4qf:function(e,a,t){(e.exports=t("I1BE")(!1)).push([e.i,".payload-modal[data-v-35a1e513]{width:100%}",""])}}]);